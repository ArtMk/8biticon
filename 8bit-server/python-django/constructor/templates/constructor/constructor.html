<!DOCTYPE html>
<html>
<head>
	<title>8biticon</title>

	<link type="text/css" href="/static/css/base.css" rel="stylesheet" />
	<link type="text/css" href="/static/css/styles.css" rel="stylesheet" />

	<link type="text/css" href="/static/8bit/css/8biticon.css" rel="stylesheet" />
	<link type="text/css" href="/static/css/index.css" rel="stylesheet" />
	<link type="text/css" href="/static/fonts/fipps/stylesheet.css" rel="stylesheet" />

	<link type="text/css" href="/static/external/jscrollpane/style/jquery.jscrollpane.css" rel="stylesheet" media="all" />

	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
	<script src="/static/javascripts/jquery.cookie.js"></script>
{#	<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>#}

	<script src="/static/8bit/js/waitForImages.js"></script>
	<script src="/static/8bit/js/8biticon.js"></script>

	<script type="text/javascript" src="/static/external/jscrollpane/script/jquery.mousewheel.js"></script>
	<script type="text/javascript" src="/static/external/jscrollpane/script/jquery.jscrollpane.min.js"></script>

	<script src="/static/javascripts/bootstrap-modal.js"></script>
	<script src="/static/javascripts/bootstrap-dropdown.js"></script>
	<script src="/static/javascripts/bootstrap-transition.js"></script>
	<script src="/static/8bit/js/bootstrap-carousel.patched.js"></script>
</head>
<body>

<div id="wrapper">
	<div id="header">
		<div class="width-setter">
			<a href="https://github.com/matveyco/8biticon" class="btn btn-primary btn-large pull-right">
				Get those sources fast!
			</a>

			<span class="heading">
			8bit icon.com
			</span>
		</div>
	</div>

	<div id="constructor">
		<div class="width-setter">
			<div class="pixel-loading">
				<div class="headline b">Loading <span class="percent"></span></div>
				<div class="progress progress-striped active"><div class="bar"></div></div>
			</div>

			<div id="constructor-panel" class="pixel">

				<div class="page-header" style="margin: 40px 50px 0;">
					<h1>8bit icon constructor <small>Customizable avatars for everyone.</small></h1>
				</div>

				<div class="viewport">
					<div class="viewport-col modal-col">
						<div class="carousel slide">
							<a href="javascript://" class="layers-regenerate underdash">Generate random image</a>

							<div class="carousel-inner">
								<div class="item"></div>
							</div>
						</div>
					</div>
					<div class="viewport-col scrollee-col">
						<div class="groups pull-right"><a href="javascript://" class="group-control" data-group="male"><img src="/static/images/constructor/male.png" title="Male" /></a> <a href="javascript://" class="group-control" data-group="female"><img src="/static/images/constructor/female.png" title="Female" /></a></div>

						<div class="tabs-bar">
							<ul class="nav nav-pills tabs">
								<li class="tab"><a href="javascript://" class="tab-text"></a></li>
							</ul>
						</div>

						<div class="layers">
							<div class="layer" style="height: 330px; max-width: 470px;">
								<div class="item"><span></span></div>
							</div>
						</div>

					</div>
				</div>

				<div style="text-align: center;">
					<div class="btn-group">
						<button class="btn btn-large" id="constructor-download-avatar">Download this image</button>
					</div>
				</div>
			</div>
		</div>
        {% csrf_token %}
	</div>
	<script type="text/javascript">
		jQuery(function ($) {
			var group = 'male';

			var constructor = $("#constructor-panel"),
					loader = $(".pixel-loading");

			constructor.pixel({
				images: '/static/8bit/img/',
				json: '/static/8bit/js/8settings.json',
				selected: true,
				startup: {
					layer: 'background',
					group: group
				},
				onLoaded: function () {
					constructor.show();
					loader.hide();
				},
				onLoading: function (loaded, length) {
					var perc = Math.ceil(100 * loaded / length);

					loader.find('.headline span').text(perc + '%').end()
						.find('.bar').width(perc + '%');
				},
				onLayerSelect: function () {
					constructor.find('.layers .layer').jScrollPane();
				},
				onGroupSelect: function () {
					var $this = $(this),
							tabs = $this.find('.tabs .tab'),
							visible = tabs;

					tabs.removeClass('first last')
							.filter(':not(.hidden-group)')
							.first().addClass('first').end()
							.last().addClass('last').end()
							.filter(':not(:first)').addClass('not-first');
				}
			});

			$("#constructor-download-avatar").on('click', function(e) {
				$("#constructor-frame, #constructor-form").remove();

				var data = constructor.pixel('selected'),
						iframe = $('<iframe />').attr({
							src: 'about:blank',
							id: 'constructor-frame',
							name: 'iframe-' + $.now()
						}).hide(),
						form = $('<form />').hide()
								.attr({
									action: '/constructor/download/',
									target: iframe.attr('name'),
									id: 'constructor-form',
									method: 'POST'
								}),
						token = $('<input type="hidden" />').attr({
							name: 'csrfmiddlewaretoken',
							value: $.cookie('csrftoken')
						}),
						encoded = $('<input type="hidden" />').attr({
							name: 'data',
							value: JSON.stringify(data)
						}),
						gender = $('<input type="hidden" />').attr({
							name: 'gender',
							value: constructor.pixel('group')
						});

				form.append(token).append(encoded).append(gender);
				form.add(iframe).appendTo(constructor);
				form.submit();
			});
		});

    </script>
</div>
<div id="footer">
	<div class="width-setter">
		<div id="footer-text">
			<div class="pull-right">Btw, developed and assembled at <a href="http://plasticjam.com/">Plastic Jam</a></div>
			<div>If you need any further information please do not hesitate contacting <a href="mailto:matvey@plasticjam.com">matvey@plasticjam.com</a></div>
		</div>
	</div>
</div>
</body>
</html>